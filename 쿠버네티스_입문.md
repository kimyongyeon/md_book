## 1. 도커

- 교재: 도커/쿠버네티스를 활용한 컨테이너 개발 실전 입문 .

### 도커란 무엇인가?
`도커`는 컨테이너형 가상화 기술을 구현하기 위한 상주 애플리케이션과 이 애플리케이션을 조작하기 위한 명령형 도구로 구성되는 프로덕트다. 애플리케이션 배포에 특화돼 있기 때문에 애플리케이션 개발 및 운영을 컨테이너 중심으로 할 수 있다.

### 도커의 역사
2013년 봄 닷클라우드사의 엔지니어였던 솔로몬 하익스가 최초로 도커를 오픈 소스로 공개했다. 이때부터 그 편리함 덕분에 도커는 점차 널리 퍼져 나갔다. 

오케스트레이션 도구 Fig를 인수 - 현재의 도커 컴포즈 

2014년부터는 도커 관련 컨퍼런스 DockerCon이 매년 개최

### 도커의 기본 개념
도커는 컨테이너형 가상화를 구현하기 위한 상주 애플리케이션과 이를 관리하는 명령형 도구로 구성된다. 

#### 컨테이너형 가상화 기술
도커는 `컨테이너형 가상화 기술`(운영체제수준가상화)을 사용한다. 
도커 이전에는 LXC가 유명했는데 도커도 초기에는 컨테이너형 가상화를 구현하는데 LXC를 런타임으로 사용(현재runC를 사용) 했다.
컨테이너형 가상화를 사용하면 소프트웨어 없이도 운영 체제의 리소스를 격리해 가상 운영 체제로 만들 수 있다. 이 가상 운영 체제를 컨테이너라고 한다. 
![imgUrl](https://miro.medium.com/max/1400/1*wOBkzBpi1Hl9Nr__Jszplg.png)


#### 애플리케이션이 중심이 되는 도커
문제점: LXC는 설정의 차이로 다른 OS에서 구동이 되지 않는 현상이 발생함.
도커와 LXC의 차이점
- 호스트 운영체제의 영향을 받지 않는 실행환경(Docker Engine을 이용한 실행 환경 표준화)
- DSL(Dockerfile)을 이용한 컨테이너 구성 및 애플리케이션 배포 정의
- 이미지 버전 관리
- 레이어 구조를 갖는 이미지 포맷(차분 빌드가 가능함)
- 도커 레지스트리(이미지 저장 서버 역할을 함)
- 프로그램 가능한 다양한 기능의 API
도커는 컨테이너 정보를 Dockerfile 코드로 관리할 수 있다. 이 코드를 기반으로 복제 및 배포가 이루지기 때문에 재현성이 높은 것이 특징이다. 

### 도커 스타일 체험하기
1. 스크립트 작성
```
#!/bin/sh
echo "hello, world!"
```
2. 스크립트를 도커에 담아보자.
```
FROM ubuntu:16.04

COPY helloworld /usr/local/bin
RUN chmod +x /usr/local/bin/helloworld

CMD ["helloworld"]
```
*1. FROM: 운영체제 정의*
*2. COPY: 셀스크립트 파일을 도커컨테이너 안의 /usr/local/bin에 복사*
*3. RUN: 도커 컨테이너 안에서 어떤 명령을 수행*
*4. CMD: 완성된 이미지를 도커 컨테이너로 실행하기 전에 먼저 실행할 명령을 정의 한다.*

3. Dockerfile을 사용해 이미지를 빌드
```
$ docker image build -t helloworld:latest .
```
4. 도커 실행
```
$ docker container run helloworld:latest
```

### 더 실용적인 예제
한번 실행되면 끝나는 어플리케이션이 아닌 계속 실행된 상태 어플리케이션 만들기
node.js 버전의 기반 이미지를 이용하되, npm으로 모듈을 추가 설치하거나 애플리케이션 빌드를 컨테이너 안에서 수행해 이미지를 만든다.
호스트 운영체제에 node.js나 npm을 설치할 필요가 없다.
이건 혼자서 만들어 보라는 소리?

### 도커를 사용하는 의의
- 변화하지 않는 실행환경으로 멱등성 확보
- 코드를 통한 실행 환격 구축 및 애플리케이션 구성
- 실행 환경과 애플리케이션의 일체화로 이식성 향상
- 시스템을 구성하는 애플리케이션 및 미들웨어의 관리 용이성

웹 어플리케이션의 프론트앤드에 아파치나 엔진엑스 같은 웹서버를 두는 것도 복잡한 절차 없이 컨테이너로 설정할 수 있게 된다. 미들웨어를 포함하는 시스템 구성 역시 설정 파일로 정의할 수 있다. 도커를 도입하면 개발 및 운영 업무가 쉬워진다.
> 도커 도입이 진정 개발 및 운영 업무를 쉽게 만들어 줄까?

#### 도커 도입전 문제점 
> B 서버에서도 같은 애플리케이션을 배포하고 싶은데, 애플리케이션 A 서버와 다르게 동작하네
> 모든 서버에 같은 아카이브를 배포하고 싶은데...,
> 서버 설정과 설치된 라이브러리가 서버마다 다르면 어쩌지?
> B 서버에 설치된 라이브러리가 버전은 낮은 거였네, 업데이트 해야 겠다.
> 서버 상태를 똑같이 유지하는 수단이 필요하겠어

#### 근복적인 원인
*인프라의 가변성을 허용*

애플리케이션을 항상 뭔가에 의존성을 갖는다. 운영체제는 물론이고, CPU나 메모리 같은 컴퓨터 리소스, 언어 런타임, 라이브러리, 애플리케이션 내부적으로 별도 프로세스로 실행하는 다른 애플리케이션 등 다양한 요소에 의존성을 가질 수 있다. 

각 서버에 배포된 애플리케이션이 동일하다면, 애플리케이션이 의존하는 환경의 차이를 가능한 한 배제 하는 것이 이 문제를 해결하는 지름길이다. 

#### 코드로 관리하는 인프라와 불변 인프라
코드로 관리하는 인프라는 코드 기반으로 인프라를 정의한다는 개념이다. 
서버를 어떻게 구성할 것인지, 어떤 라이브러리 도구를 설치할지를 코드로 정의하고 셰프나 앤서블 같은 프로비저닝 도구로 서버를 구축한다. 수작업이 개입할 여지를 줄이고 코드 중심으로 바꿈으로써 쉽게 같은 구성의 서버 여러 대를 복제할 수 있다. 

***코드로 관리하는 인프라 역시 만병 통치약은 아니다.***
아래의 경우를 보자.
```bash 
$ nodebrew install-binary stable
```
이것은 Node.js 버전 관리 도구인 nodebrew에서 안정 버전(stable)을 설치하도록 설정하는 명령이다. stable이 가리키는 버전은 생각보다 자주 변하기 때문에 이런 방식으로는 항상 같은 결과가 보장되지 않는다. 환경 차이 문제를 피하려면 언제든 몇 번을 실행해 같은 결과가 보장되는 멱등성을 확보해야 한다. 애플리케이션이 의존하는 런타임이나 라이브러리 모두가 확실하게 특정 버전으로 설치되도록 코드를 작성해야 한다.

그러나 `항구적인 코드`를 계속 작성하는 것은 운영 업무에 부담을 주기 쉽다.

이 문제의 해결방안은 `불변 인프라 개념`이다. 불변 인프라는 `어떤 시점의 서버 상태를 저장`해 복제할수 있게 하자는 개념이다. 제대로 설정된 상태의 서버를 항상 사용할 수 있다는 점이 가장 큰 장점이다. 

서버에 변경을 가하고 싶은 경우에는 기존 인프라를 수정하는 대신 `새로운 서버를 구축`하고 `그 상태를 이미지로 저장`한 다음 그 `이미지를 복제`한다. 한번 설정된 서버는 수정 없이 파기되므로 멱등성을 신경쓸 필요조차 없다. 

도커를 사용하면 코드로 관리하는 인프라와 불변 인프라의 두 개념을 간단하고 낮은 비용으로 실현할 수 있다. 
인프라 구성이 Dockerfile로 관리되므로 코드로 관리하는 인프라는 도커의 대원칙이다. 

도커는 도커 이미지(Dockerfile)로 서버 구성을 코드로 관리할 수 있다. 그러므로 기존 컨테이너를 빠르게 폐기하고 새로이 구축할 수 있다. 코드로 관리하는 인프라와 불변 인프라라는 두 개념 모두를 쉽게 구현할 수 있는 도구라고 할 수 있다. 

최근 아마존이나 GCP 같은 플랫폼은 가상머신을 쉽게 만들고 파기할 수 있는 시대이긴 하지만 호스트 가상화 방식에서는 가상머신을 시작하는데 적어도 1분에서 수분까지 시간이 걸린다. 호스트 가상화 기술은 가상화 소프트웨어로 컴퓨터 리소스를 추상화하는 방식이기 때문이다. 클라우드에서 도커를 사용할 때도 이런 점을 감안하는 것이 좋다.

#### 애플리케이션과 인프라 묶어 구축하기

### 애플리케이션 구성 관리의 용이성

#### 도커 컨테이너 오케스트레이션 시스템




### 도커 환경설정에 대해서 알아보자.
- 가상머신 설치 하기.
- 도커 설치 하기.
- 도커 명령어 익히기.
- 도커 스윔에 대해서 알아보자.

## 2. 쿠버네티스

## 3. 호스트

- AWS
  - 가입하기
  - EKS 설정하기
  - 컨테이너 올리기 

- 디지털오션

- GCP

- 알리클라우드

